name: â¬‡ï¸ Hosting on the VPS
run-name: ${{ github.actor }} is hosting the project on the VPS ðŸš€

on: [push]
jobs:
  Deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Prompt before Checkout
        run: echo "â¤µï¸ Checking out project code"
      - name: Checkout
        uses: actions/checkout@v3

      - name: Prompt before Install SSH client
        run: echo "ðŸ‘¨â€ðŸ”§ Installing SSH client"
      - name: Install SSH client
        run:
          sudo apt-get install -y sshpass && echo "âœ… Successfully installed"

      - name: Prompt before Send files via SSH
        run: echo "âž¡ï¸ Sending files vie SSH"
      - name: Send files via SSH
        run: >-
          sshpass -p ${{ secrets.API_HOST_SSH_API }}  
          rsync -e "ssh -o StrictHostKeyChecking=no" -r ${{ github.workspace }}/*  
          api@92.63.177.74:/home/api/api/ && 
          echo "âœ… Successfully sent"

  Restart:
    needs: Deploy
    runs-on: ubuntu-latest
    steps:
      - name: Prompt before Install SSH client
        run: echo "ðŸ‘¨â€ðŸ”§ Installing SSH client"
      - name: Install SSH client
        run:
          sudo apt-get install -y sshpass && echo "âœ… Successfully installed"

      - name: Prompt before Restart service
        run: echo "ðŸ”„ Restarting API service"
      - name: Restart service
        run: >- 
          sshpass -p ${{ secrets.API_HOST_SSH_ROOT }} ssh -t root@92.63.177.74 
          "systemctl restart api"
