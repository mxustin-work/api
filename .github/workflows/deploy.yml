name: ⬇️ Hosting on the VPS
run-name: ${{ github.actor }} is hosting the project on the VPS 🚀

on: [push]
jobs:
  Deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v3

      - name: Install SSH client
        run:
          echo "👨‍🔧 Installing SSH client"
          sudo apt-get install sshpass
          echo "✅ Successfully installed"

      - name: Send files via SSH
        run:
          echo "🚛 Sending files vie SSH"
          sshpass -p ${{ secrets.API_HOST_SSH_API }} \ 
          rsync -e "ssh -o StrictHostKeyChecking=no" -r ${{ github.workspace }}/* \ 
          api@92.63.177.74:/home/api/api/ && \
          echo "✅ Successfully sent"

  Restart-service:
    runs-on: ubuntu-latest
    steps:
      - name: SSH into server
        uses: appleboy/ssh-action@master
        with:
          host: 92.63.177.74
          username: root
          password: ${{ secrets.API_HOST_SSH_ROOT }}

      - name: Restart service
        run:
          echo "🔄 Restarting API service"
          systemctl restart api
          echo "✅ Successfully sent"
